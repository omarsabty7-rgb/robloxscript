local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local Title = Instance.new("TextLabel")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Variables
local AimbotEnabled = false
local Flying = false
local SpeedEnabled = false
local JumpEnabled = false
local NoclipEnabled = false
local Smoothness = 0.15 -- كلما قل الرقم زادت النعومة (0.1 هادئ جداً، 0.5 سريع)

-- Setup UI
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0, 225, 0, 480)
MainFrame.Active = true
MainFrame.Draggable = true

UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "ELITE HUB V4 | SMOOTH"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
local TitleCorner = Instance.new("UICorner")
TitleCorner.Parent = Title

local function CreateButton(text, pos, color, callback)
    local btn = Instance.new("TextButton")
    btn.Parent = MainFrame
    btn.Text = text
    btn.Position = pos
    btn.Size = UDim2.new(0.85, 0, 0, 35)
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 14
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Loops for Speed, Jump and Noclip
RunService.Heartbeat:Connect(function()
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        if SpeedEnabled then char.Humanoid.WalkSpeed = 100 end
        if JumpEnabled then char.Humanoid.JumpPower = 150 char.Humanoid.UseJumpPower = true end
        if NoclipEnabled then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = false end
            end
        end
    end
end)

-- Buttons
CreateButton("Super Speed: TOGGLE", UDim2.new(0.07, 0, 0.1, 0), Color3.fromRGB(45, 45, 45), function()
    SpeedEnabled = not SpeedEnabled
end)

CreateButton("High Jump: TOGGLE", UDim2.new(0.07, 0, 0.2, 0), Color3.fromRGB(45, 45, 45), function()
    JumpEnabled = not JumpEnabled
end)

CreateButton("Smart ESP (Team Check)", UDim2.new(0.07, 0, 0.3, 0), Color3.fromRGB(45, 45, 45), function()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character then
            local highlight = Instance.new("Highlight")
            highlight.Parent = player.Character
            if player.Team == game.Players.LocalPlayer.Team then
                highlight.FillColor = Color3.fromRGB(0, 0, 255)
            else
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
            end
        end
    end
end)

CreateButton("Fly & Noclip (WASD)", UDim2.new(0.07, 0, 0.4, 0), Color3.fromRGB(45, 45, 45), function()
    Flying = not Flying
    NoclipEnabled = Flying
    local char = game.Players.LocalPlayer.Character
    local root = char:FindFirstChild("HumanoidRootPart")
    if Flying then
        local bv = Instance.new("BodyVelocity", root)
        bv.Name = "FlyVel"
        bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        task.spawn(function()
            while Flying do
                local cam = workspace.CurrentCamera.CFrame
                local newVel = Vector3.new(0, 0, 0)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then newVel = newVel + cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then newVel = newVel - cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then newVel = newVel + cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then newVel = newVel - cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then newVel = newVel + Vector3.new(0, 1, 0) end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then newVel = newVel - Vector3.new(0, 1, 0) end
                bv.Velocity = newVel * 100
                task.wait()
            end
            bv:Destroy()
        end)
    end
end)

CreateButton("Smooth Aimbot: TOGGLE", UDim2.new(0.07, 0, 0.5, 0), Color3.fromRGB(60, 20, 20), function()
    AimbotEnabled = not AimbotEnabled
end)

-- Optimized Smooth Aimbot Loop
RunService.RenderStepped:Connect(function()
    if AimbotEnabled then
        local target = nil
        local dist = 1000
        local myTeam = game.Players.LocalPlayer.Team

        for _, p in pairs(game.Players:GetPlayers()) do
            -- Team Check Added Here
            if p ~= game.Players.LocalPlayer and p.Team ~= myTeam and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local d = (p.Character.HumanoidRootPart.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if d < dist then target = p dist = d end
            end
        end

        if target then
            local cam = workspace.CurrentCamera
            local targetPos = CFrame.new(cam.CFrame.Position, target.Character.HumanoidRootPart.Position)
            -- Smooth transition using Lerp
            cam.CFrame = cam.CFrame:Lerp(targetPos, Smoothness)
        end
    end
end)

CreateButton("CLOSE HUB", UDim2.new(0.07, 0, 0.88, 0), Color3.fromRGB(150, 0, 0), function()
    ScreenGui:Destroy()
end)
