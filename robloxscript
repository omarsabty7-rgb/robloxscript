local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local Title = Instance.new("TextLabel")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Default Values
local AimbotEnabled = false
local Flying = false
local SpeedEnabled = false
local JumpEnabled = false
local NoclipEnabled = false

local WalkSpeedValue = 100
local JumpPowerValue = 150
local FlySpeedValue = 100
local SmoothnessValue = 1

-- Setup UI
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0, 280, 0, 540) 
MainFrame.Active = true
MainFrame.Draggable = true

UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "ELITE HUB V6 | TOGGLE MODE"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
local TitleCorner = Instance.new("UICorner")
TitleCorner.Parent = Title

-- Function to create Smart Toggle Button + TextBox
local function CreateControl(name, pos, defaultValue, callback)
    local active = false
    
    local btn = Instance.new("TextButton")
    btn.Parent = MainFrame
    btn.Text = name .. ": [OFF]"
    btn.Position = pos
    btn.Size = UDim2.new(0.6, 0, 0, 35)
    btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 11
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    
    local input = Instance.new("TextBox")
    input.Parent = MainFrame
    input.Text = tostring(defaultValue)
    input.Position = UDim2.new(pos.X.Scale + 0.65, 0, pos.Y.Scale, 0)
    input.Size = UDim2.new(0.2, 0, 0, 35)
    input.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    input.TextColor3 = Color3.fromRGB(0, 255, 0)
    input.Font = Enum.Font.SourceSansBold
    input.TextSize = 14
    local inputCorner = Instance.new("UICorner")
    inputCorner.Parent = input

    btn.MouseButton1Click:Connect(function()
        active = not active
        if active then
            btn.Text = name .. ": [ON]"
            btn.BackgroundColor3 = Color3.fromRGB(0, 100, 0) -- Green
        else
            btn.Text = name .. ": [OFF]"
            btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45) -- Gray
        end
        callback("toggle", active)
    end)
    
    input.FocusLost:Connect(function()
        callback("value", tonumber(input.Text))
    end)
end

-- Normal Button Function
local function CreateNormalButton(text, pos, color, callback)
    local btn = Instance.new("TextButton")
    btn.Parent = MainFrame
    btn.Text = text
    btn.Position = pos
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 12
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    btn.MouseButton1Click:Connect(callback)
end

-- Heartbeat Loop
RunService.Heartbeat:Connect(function()
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        if SpeedEnabled then char.Humanoid.WalkSpeed = WalkSpeedValue end
        if JumpEnabled then char.Humanoid.JumpPower = JumpPowerValue char.Humanoid.UseJumpPower = true end
        if NoclipEnabled then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = false end
            end
        end
    end
end)

-- Creating Controls with ON/OFF Logic
CreateControl("SPEED", UDim2.new(0.05, 0, 0.12, 0), WalkSpeedValue, function(type, val)
    if type == "toggle" then SpeedEnabled = val else WalkSpeedValue = val end
end)

CreateControl("JUMP", UDim2.new(0.05, 0, 0.22, 0), JumpPowerValue, function(type, val)
    if type == "toggle" then JumpEnabled = val else JumpPowerValue = val end
end)

CreateControl("FLY", UDim2.new(0.05, 0, 0.32, 0), FlySpeedValue, function(type, val)
    if type == "toggle" then 
        Flying = val
        NoclipEnabled = val
        local char = game.Players.LocalPlayer.Character
        local root = char:FindFirstChild("HumanoidRootPart")
        if Flying then
            local bv = Instance.new("BodyVelocity", root)
            bv.Name = "FlyVel"
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            task.spawn(function()
                while Flying do
                    local cam = workspace.CurrentCamera.CFrame
                    local newVel = Vector3.new(0, 0, 0)
                    if UserInputService:IsKeyDown(Enum.KeyCode.W) then newVel = newVel + cam.LookVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.S) then newVel = newVel - cam.LookVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.D) then newVel = newVel + cam.RightVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.A) then newVel = newVel - cam.RightVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then newVel = newVel + Vector3.new(0, 1, 0) end
                    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then newVel = newVel - Vector3.new(0, 1, 0) end
                    bv.Velocity = newVel * FlySpeedValue
                    task.wait()
                end
                if bv then bv:Destroy() end
            end)
        end
    else FlySpeedValue = val end
end)

CreateControl("AIMBOT", UDim2.new(0.05, 0, 0.42, 0), SmoothnessValue, function(type, val)
    if type == "toggle" then AimbotEnabled = val else SmoothnessValue = val end
end)

-- ESP Button
CreateNormalButton("SMART ESP (TEAM CHECK)", UDim2.new(0.05, 0, 0.52, 0), Color3.fromRGB(45, 45, 45), function()
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character then
            local highlight = Instance.new("Highlight")
            highlight.Parent = player.Character
            if player.Team == game.Players.LocalPlayer.Team then
                highlight.FillColor = Color3.fromRGB(0, 0, 255)
            else
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
            end
        end
    end
end)

-- Aimbot Logic
RunService.RenderStepped:Connect(function()
    if AimbotEnabled then
        local target = nil
        local dist = 1000
        local myTeam = game.Players.LocalPlayer.Team
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= game.Players.LocalPlayer and p.Team ~= myTeam and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local d = (p.Character.HumanoidRootPart.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if d < dist then target = p dist = d end
            end
        end
        if target then
            local cam = workspace.CurrentCamera
            local targetPos = CFrame.new(cam.CFrame.Position, target.Character.HumanoidRootPart.Position)
            cam.CFrame = cam.CFrame:Lerp(targetPos, SmoothnessValue)
        end
    end
end)

-- Close Button
CreateNormalButton("CLOSE HUB", UDim2.new(0.05, 0, 0.88, 0), Color3.fromRGB(150, 0, 0), function()
    ScreenGui:Destroy()
end)
